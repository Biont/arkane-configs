echo "Setting up swap"

arch-chroot $workdir btrfs filesystem mkswapfile --size 40G /swapfile

arch-chroot $workdir swapon /swapfile

OFFSET=$(arch-chroot $workdir btrfs inspect-internal map-swapfile -r swapfile)

arch-chroot $workdir 'echo "

/swapfile none swap defaults 0 0

" >> /etc/fstab'

arch-chroot $workdir 'echo "

add_dracutmodules+=\" resume \"
kernel_cmdline+=\" resume=/dev/disk/by-label/arkane_root resume_offset='$OFFSET' \"

" > /etc/dracut.conf.d/resume-from-hibernate.conf'
